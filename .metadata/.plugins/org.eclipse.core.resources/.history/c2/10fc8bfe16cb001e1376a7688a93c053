package com.application.sevices;

private final String filePath = "User.ser";

public String save(User user) {
	File file = new File(filePath);
    if (!file.exists()) {
        try {
			file.createNewFile();
		} catch (IOException e) {
			e.printStackTrace();
    }
	try (ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(filePath, true))) {
        outputStream.writeObject(user);
    } catch (IOException e) {
        e.printStackTrace();
    }
	return "user registered successfully";
}


public List<User> get()  {
	List<User> users = new ArrayList<>();
    try (ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(filePath))) {
        while (true) {
            try {
                User user = (User) inputStream.readObject();
                users.add(user);
            } catch (EOFException e) {
                break;
            }
        }
    } catch (IOException | ClassNotFoundException e) {
        e.printStackTrace();
    }
    return users;
}

public String login(User userModel) {
    List<User> users = get();
    for (User user : users) {
        if (user.getUsername().equals(userModel.getUsername()) && user.getPassword().equals(userModel.getPassword())) {
            return "user loggedin successfully";
        }
    }
    throw new DetailNotFoundException("User is not registered with this username/password");
}
}
